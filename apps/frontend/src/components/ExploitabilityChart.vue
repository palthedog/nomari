<template>
  <div class="exploitability-chart">
    <h4>Exploitability</h4>
    <div class="chart-container">
      <div v-if="data.length === 0" class="placeholder">
        <div class="placeholder-icon">ğŸ“Š</div>
        <p>è¨ˆç®—ã‚’é–‹å§‹ã™ã‚‹ã¨Exploitabilityã®æ¨ç§»ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
        <span class="coming-soon">Coming Soon</span>
      </div>
      <svg v-else class="chart-svg" :viewBox="viewBox">
        <!-- Grid lines -->
        <g class="grid">
          <line
            v-for="i in 5"
            :key="'h-' + i"
            :x1="padding"
            :x2="chartWidth + padding"
            :y1="padding + ((i - 1) * chartHeight) / 4"
            :y2="padding + ((i - 1) * chartHeight) / 4"
            stroke="#e0e0e0"
            stroke-width="1"
          />
        </g>

        <!-- Axis -->
        <line
          :x1="padding"
          :x2="chartWidth + padding"
          :y1="chartHeight + padding"
          :y2="chartHeight + padding"
          stroke="#666"
          stroke-width="1"
        />
        <line
          :x1="padding"
          :x2="padding"
          :y1="padding"
          :y2="chartHeight + padding"
          stroke="#666"
          stroke-width="1"
        />

        <!-- Line chart -->
        <polyline
          v-if="points.length > 1"
          :points="pointsString"
          fill="none"
          stroke="#2196F3"
          stroke-width="2"
        />

        <!-- Data points -->
        <circle
          v-for="(point, index) in points"
          :key="index"
          :cx="point.x"
          :cy="point.y"
          r="3"
          fill="#2196F3"
        />

        <!-- Labels -->
        <text :x="chartWidth / 2 + padding" :y="chartHeight + padding + 20" text-anchor="middle" font-size="10" fill="#666">
          ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        </text>
        <text :x="10" :y="chartHeight / 2 + padding" text-anchor="middle" font-size="10" fill="#666" transform="rotate(-90, 10, 100)">
          Exploitability
        </text>
      </svg>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';

interface DataPoint {
  iteration: number;
  value: number;
}

const props = defineProps<{
  data: DataPoint[];
}>();

// Chart dimensions
const width = 280;
const height = 150;
const padding = 30;
const chartWidth = width - padding * 2;
const chartHeight = height - padding * 2;

const viewBox = computed(() => `0 0 ${width} ${height}`);

// Calculate scaled points
const points = computed(() => {
  if (props.data.length === 0) return [];

  const maxIteration = Math.max(...props.data.map((d) => d.iteration));
  const maxValue = Math.max(...props.data.map((d) => d.value));

  return props.data.map((d) => ({
    x: padding + (d.iteration / maxIteration) * chartWidth,
    y: padding + chartHeight - (d.value / (maxValue || 1)) * chartHeight,
  }));
});

const pointsString = computed(() => {
  return points.value.map((p) => `${p.x},${p.y}`).join(' ');
});
</script>

<style scoped>
.exploitability-chart {
  background-color: white;
  border: 1px solid #e0e0e0;
  border-radius: 4px;
  padding: 12px;
}

.exploitability-chart h4 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #333;
}

.chart-container {
  min-height: 120px;
}

.placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100px;
  color: #9e9e9e;
  text-align: center;
}

.placeholder-icon {
  font-size: 32px;
  margin-bottom: 8px;
}

.placeholder p {
  margin: 0 0 8px 0;
  font-size: 12px;
}

.coming-soon {
  padding: 2px 8px;
  background-color: #9e9e9e;
  color: white;
  font-size: 10px;
  border-radius: 3px;
}

.chart-svg {
  width: 100%;
  height: auto;
}
</style>
